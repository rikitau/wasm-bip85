<html>
<head>
<meta content="text/html;charset=utf-8" http-equiv="Content-Type"/>
<title>BIP-85 entropy from extended private key</title>
<style>
main{
    display: flex;
    flex-direction: column;
    margin: auto;
    max-width: 900px;
    padding: 50px;
    font-family: -apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji;
}
input[type="text"]{
    max-width: 800px;
}
input[type="number"]{
    max-width: 100px;
}
input{
    padding: 10px 5px;
    margin: 10px 0 20px 0;
}
#error{
    color: #a70000;
}
a{
    color: #0366d6;
}
.tabs{
    display: flex;
    flex-direction: row;
}
.tabs input[type=radio]{
    display: none;
}
.tabs label{
    flex-grow: 1;
    padding: 10px 15px;
    border: 1px solid transparent;
    cursor: pointer;
    border-radius: 5px 5px 0 0;
}
.tabs input[type=radio]:checked + label{
    border: 1px solid #e0e0e0;
    background: #e0e0e0;
}
.tabs label:hover{
    background: #f0f0f0;
}
.tab-content > div{
    display: none;
}
.tab-content{
    padding: 10px 15px;
    border: 1px solid #e0e0e0;
}
</style>
</head>
<body>
<main>
    <h1><a href="https://github.com/bitcoin/bips/blob/master/bip-0085.mediawiki" target="_blank">BIP-85</a> entropy from extended private key</h1>
    <h2>Input</h2>

    <div class="tabs" id="input-tabs">
        <input type="radio" name="input-type" id="input-xprv" value="xprv" checked/>
        <label for="input-xprv">Extended private key</label>

        <input type="radio" name="input-type" id="input-mnemonic" value="mnemonic"/>
        <label for="input-mnemonic">BIP-39 recovery phrase</label>

        <input type="radio" name="input-type" id="input-wif" value="wif"/>
        <label for="input-wif">HD seed (WIF)</label>
    </div>
    <div class="tab-content" for="input">
        <div for="xprv">
            xprv content
        </div>
        <div for="mnemonic">
            mnemonic content
        </div>
        <div for="wif">
            wif content
        </div>
    </div>
    <label for="xprv">Root key:</label>
    <input type="text"
             id="xprv"
             placeholder="Enter your xprv"
             value="xprv9s21ZrQH143K2LBWUUQRFXhucrQqBpKdRRxNVq2zBqsx8HVqFk2uYo8kmbaLLHRdqtQpUm98uKfu3vca1LqdGhUtyoFnCNkfmXRyPXLjbKb"
    />
    <label for="index">Derivation index:</label>
    <input type="number" id="index" value="0" min="0" max="2147483647" step="1"/>

    <h2>Output</h2>
    <div class="tabs" id="output-tabs">
        <input type="radio" name="output-type" id="output-xprv" value="xprv" checked/>
        <label for="output-xprv">Extended private key</label>

        <input type="radio" name="output-type" id="output-wif" value="hex"/>
        <label for="output-wif">WIF HD key</label>

        <input type="radio" name="output-type" id="output-mnemonic" value="mnemonic"/>
        <label for="output-mnemonic">BIP-39 recovery phrase</label>

        <input type="radio" name="output-type" id="output-hex" value="hex"/>
        <label for="output-hex">Hex entropy</label>
    </div>
    <div class="tab-content" for="output">
        <div for="xprv">
            xprv output content
        </div>
        <div for="wif">
            wif output content
        </div>
        <div for="mnemonic">
            mnemonic output content
        </div>
        <div for="hex">
            hex output content
        </div>
    </div>
    <div id="result">
        <h3>WIF:</h3>
        <div id="wif"></div>
        <h3>BIP39 12 words mnemonic:</h3>
        <div id="bip39-12"></div>
        <h3>BIP39 24 words mnemonic:</h3>
        <div id="bip39-24"></div>
    </div>
    <div id="error">
    </div>
</main>

<script type="module">

import init, {
    to_wif, to_mnemonic,
    root_from_mnemonic, root_from_wif,
} from './pkg/wasm_bip85.js';

// ckeck input type
function change_input(){
    let val = document.querySelector('input[name="input-type"]:checked').value;
    console.log(val);
    document.querySelectorAll('.tab-content[for="input"] > div').forEach((div) => {
        if(div.getAttribute('for') == val){
            div.style.display = 'block';
        }else{
            div.style.display = 'none';
        }
    });
}
document.querySelectorAll('input[name="input-type"]').forEach((input) => {
    input.addEventListener('change', change_input);
});

function change_output(){
    let val = document.querySelector('input[name="output-type"]:checked').value;
    console.log(val);
    document.querySelectorAll('.tab-content[for="output"] > div').forEach((div) => {
        if(div.getAttribute('for') == val){
            div.style.display = 'block';
        }else{
            div.style.display = 'none';
        }
    });
}
document.querySelectorAll('input[name="output-type"]').forEach((input) => {
    input.addEventListener('change', change_output);
});


// small handy function to release the gui
function sleep(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
}

async function run() {
    // initialize wasm module
    await init();
    // get input type, calc xprv
    await change_input();
    await change_output();
    // get output
    await update();
    document.getElementById("xprv")
    .addEventListener("change", ()=>{
        update();
    });
    document.getElementById("index")
    .addEventListener("change", ()=>{
        update();
    });
}
async function update(){
    let xprv = document.getElementById("xprv").value;
    let idx = parseInt(document.getElementById("index").value);
    console.log(xprv);
    try{
        let wif = to_wif(xprv, idx);
        await sleep(1);
        document.getElementById("wif").innerHTML = wif;
        for (const num_words of [12, 24]) {
            let bip39 = to_mnemonic(xprv, num_words, idx);
            document.getElementById(`bip39-${num_words}`).innerHTML = bip39;
            await sleep(1);
        }
        // how result block, hide error
        document.getElementById("result").style.display = "";
        document.getElementById("error").style.display = "none";
    }catch(err){
        console.log(err);
        document.getElementById("error").innerHTML = err;
        document.getElementById("result").style.display = "none";
        document.getElementById("error").style.display = "";
    }
}

run();
</script>
</body>
</html>

